# 硬件配置
---
6c16g

## 1. jvm演练总结
> 使用 GCLogAnalysis.java 自己演练一遍串行 / 并行 /CMS/G1 的案例。

### 1.1 SerialGC
```
java -XX:+UseSerialGC -Xms512m -Xmx512m -XX:+PrintGCDetails -Xloggc:gc.demo.log -XX:+PrintGCDateStamps GCLogAnalysis
```
| GC类型 | Xmx(Xms) | GC | YGC | FGC | GCT | YGCT | FGCT | NOTE |   
| :--- | :--- | :--- | :--- |  :--- | :--- | :--- |  :--- |  :--- |
| 串行 | 128m |  |  |  |  |  |  | OOM |
| 串行 | 512m | 22 | 9 | 13 | 0.63 | 0.19 | 0.44 |   |
| 串行 | 1g | 9 | 8 | 1 | 0.54 | 0.46 | 0.07 |  |
| 串行 | 2g | 5 | 5 | 0 | 0.48 | 0.48 | 0 |  |
| 串行 | 4g | 2 | 2 | 0 | 0.33 | 0.33 | 0 | |

| GC类型 | Xmx(Xms) | GC | YGC | FGC | GCT | YGCT | FGCT | NOTE |   
| :--- | :--- | :--- | :--- |  :--- | :--- | :--- |  :--- |  :--- |
| 并行 | 128m |  |  |  |  |  |  | OOM |
| 并行 | 512m | 36 | 26 | 10 | 0.59 | 0.24 | 0.35 |   |
| 并行 | 1g | 23 | 22 | 1 | 0.45 | 0.41 | 0.05 |  |
| 并行 | 2g | 7 | 7 | 0 | 0.38 | 0.38 | 0 |  |
| 并行 | 4g | 3 | 3 | 0 | 0.31 | 0.31 | 0 | |

| GC类型 | Xmx(Xms) | GC | YGC | FGC | GCT | YGCT | FGCT | NOTE |   
| :--- | :--- | :--- | :--- |  :--- | :--- | :--- |  :--- |  :--- |
| CMS | 128m |  |  |  |  |  |  | OOM |
| CMS | 512m | 33 | 24 | 9 | 0.61 | 0.41 | 0.2 |   |
| CMS | 1g | 18 | 17 | 1 | 0.44 | 0.38 | 0.06 |  |
| CMS | 2g | 7 | 7 | 0 | 0.38 | 0.38 | 0 |  |
| CMS | 4g | 5 | 5 | 0 | 0.35 | 0.35 | 0 | |

| GC类型 | Xmx(Xms) | GC | YGC | FGC | GCT | YGCT | FGCT | NOTE |   
| :--- | :--- | :--- | :--- |  :--- | :--- | :--- |  :--- |  :--- |
| G1 | 128m |  |  |  |  |  |  | OOM |
| G1 | 512m | 161 | 160 | 1 | 0.38 | 0.35 | 0..03 |   |
| G1 | 1g | 42 | 42 | 0 | 0.2 | 0.2 | 0 |  |
| G1 | 2g | 8 | 8 | 0 | 0.1 | 0.1 | 0 |  |
| G1 | 4g | 13 | 13 | 0 | 0.38 | 0.38 | 0 | |

总结：
1. 512M 小堆内存下 GC次数 G1 > CMS > 并行 > 串行   原因  分小区域处理优化、多线程的处理 
2. FullGC耗费时间 串行 > 并行 > CMS > G1  原因 GC算法的优化，主要针对FullGC的优化
3. 随着堆内存的增大，可以降低GC次数(特别是FullGC次数)及GC暂停时间
4. G1GC会提高新生代GC的频率，但是总的GC暂停时间却是减小的，由于区域化region处理
5. CMSGC相较于并行GC，并不会降低总的GC时间与GC次数


## 压测演练总结

> 使用压测工具（wrk 或 sb），演练 gateway-server-0.0.1-SNAPSHOT.jar 示例

压测命令：`wrk -t 16 -c 100 -d60s --latency http://localhost:8088/api/hello`

##### 不同GC收集器比较
| GC类型 | Xmx(Xms) | QPS | 响应时间(Avg/Max) | GC总时间 | 平均GC时间 | GC总次数
| :--- | :--- | :--- | :--- |  :--- |  :--- |  :--- | 
| 串行 | 2g | 41974 | 28.69/982 | 514 |  5.141 | 100 |
| 并行 | 2g | 44235 | 21.55/1100 | 211 | 2.376 | 89 | 
| CMS | 2g | 41999 | 13.9/1010 | 430 | 4.221 | 102 |
| G1 | 2g | 43495 | 12.46/398 | 290 | 6.315 | 46 |


总结：从数据看；去验证GC的选择原则 
* 系统吞吐量优先，参考QPS指标，使用 并行GC；
* 系统低延迟优先，参考响应时间，使用 CMS GC；